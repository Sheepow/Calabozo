Object subclass: #Game	instanceVariableNames: 'movimientoValido escenario conjuntoDeEscenarios'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Game methodsFor: 'InicializacionesElementosAuxiliares' stamp: 'EduardoValenzuela 10/22/2012 10:13'!inicializaConjuntoDeEscenarios 	"Por ahora el metodo regresara nulo, este metodo estara en funcion de la estructura de Escenario"	^nil! !!Game methodsFor: 'InicializacionesElementosAuxiliares' stamp: 'EduardoValenzuela 10/22/2012 10:12'!inicializaEscenario 	^ Escenario new.! !!Game methodsFor: 'initialize-release' stamp: 'EduardoValenzuela 10/24/2012 08:39'!initialize 	super initialize.	escenario := self inicializaEscenario.	escenario setMotorDeJuego:self.	escenario setDelegadoDeAcciones: self .	escenario asignaDelegados.	conjuntoDeEscenarios := self inicializaConjuntoDeEscenarios.	escenario openInWorld .				! !!Game methodsFor: 'initialize-release' stamp: 'EduardoValenzuela 10/23/2012 01:03'!verificaEntidadesEnPuntox: puntoX yEnY: puntoY	escenario ! !!Game methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 16:34'!laEntidad: unaEntidad haSolapadoA: otraEntidadTranscript show: unaEntidad class superclass  asString , '  : ' , otraEntidad class superclass asString ; cr.( ( (unaEntidad class superclass asString asSymbol)  == #Personaje ) &  ( ( otraEntidad class superclass asString  asSymbol)  == #Objeto ) ) ifTrue:   [	otraEntidad SurtirEfectoa: unaEntidad .  ].( ( ( unaEntidad className asSymbol)  == #Arma ) &  ( ( otraEntidad class superclass asString  asSymbol)  == #Personaje ) ) ifTrue:   [	unaEntidad  SurtirEfectoa: otraEntidad  .  ]! !Morph subclass: #Entidad	instanceVariableNames: 'delegadoDeNivel'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/2/2012 10:52'!cambiarSprite: unIndice enElConjuntoDeSprites: elConjunto	self ! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:42'!commitSepukku	delegadoDeNivel quitarLaInstancia: self.	self delete .! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 13:14'!doesNotUnderstand: aMessage"Este maneja todos los mensajes que no se entienden de sus pequeñines subclases y los arroja a transcript, porque usar transcript es bueno."Transcript show: '-------------------WARNING--------------------Señor, es probable que no haya programado bien esto, pues no entendi bien ', aMessage asString , ' .';cr.! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:43'!hacerHarakiri 	delegadoDeNivel quitarLaInstancia: self.	self delete .! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 10:11'!initialize 	super initialize .! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 11:31'!obtenersuperclassName	Transcript show: 'Superclass'! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/2/2012 10:41'!posX	^self position x.! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/2/2012 10:42'!posY	^self position y.! !!Entidad methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:50'!setDelegadoDeNivel: unDelegado	delegadoDeNivel := unDelegado ! !Entidad subclass: #Personaje	instanceVariableNames: 'delegadoMovimiento hp maxhp orientacion'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:04'!HP	^hp! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/23/2012 08:18'!asignaDelegadoMovimiento: unDelegado	delegadoMovimiento := unDelegado ! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:21'!aumentarHP: unaCantidadAAumentar	"Aqui es donde nuestro heroe aumenta sus hit points de acuerdo al maximo"	((self HP + unaCantidadAAumentar) > self maxHP) 	ifTrue: [		self sethp: self maxHP	] ifFalse: [		self sethp:  (self HP + unaCantidadAAumentar )	] .	Transcript show: 'HP maximo es: ', self maxHP asString ; cr.	Transcript show: 'La cantidad de HP de', self asString ,' es de', self HP asString,'!!!!'; cr.! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 16:25'!disminuirHP: unaCantidadAdisminuir	"Aqui es donde nuestro un personaje disminuye sus hit points :("	self sethp: (self HP - unaCantidadAdisminuir ).	Transcript show: 'HP maximo es: ', self maxHP asString ; cr.	Transcript show: 'La cantidad de HP de', self asString ,' es de', self HP asString,'!!!!'; cr.! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:14'!initialize 	super initialize .	self setMaxHP: 12.	self sethp: 5.	! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:11'!maxHP	^maxhp! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/25/2012 11:05'!orientacion  ^orientacion ! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:13'!setMaxHP: cantidadNuevaDeMaximoHP	maxhp := cantidadNuevaDeMaximoHP ! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/25/2012 11:05'!setOrientacion: unValor	orientacion := unValor ! !!Personaje methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:13'!sethp: cantidadNuevaDeHP	hp := cantidadNuevaDeHP ! !Personaje subclass: #Enemigo	instanceVariableNames: 'movimientoValido'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Enemigo methodsFor: 'as yet unclassified' stamp: 'IvanMadrid 10/28/2012 19:23'!initialize 	super initialize .	self addMorph: (ImageReadWriter formFromFileNamed: 'enemy.png') asMorph.	self height: 3.0.	self width: 3.0.	self bounds:( (190@240) corner: (0@0)).! !Entidad subclass: #ObjetoDeEscenario	instanceVariableNames: 'sePuedeTraspasar'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!ObjetoDeEscenario methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/21/2012 23:57'!SetSePuedeTraspasar: anStatement	sePuedeTraspasar  = anStatement ! !!ObjetoDeEscenario methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/21/2012 23:58'!esTraspasable	^sePuedeTraspasar ! !ObjetoDeEscenario subclass: #CorazonJugador	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!CorazonJugador methodsFor: 'as yet unclassified' stamp: 'IvanMadrid 10/28/2012 19:53'!initialize	"comment stating purpose of message"self addMorph: (ImageReadWriter formFromFileNamed: 'heart.png') asMorph.self height: 3.0.self width: 3.0.! !ObjetoDeEscenario subclass: #Objeto	instanceVariableNames: ''	classVariableNames: 'nombre'	poolDictionaries: ''	category: 'AdventureGame'!!Objeto methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 10:32'!SurtirEfectoa: laEntidad"Este metodo se hizo para hacer override *Guiño Guiño*"	Transcript show: '****Efecto desconocido para ', laEntidad asString .! !!Objeto methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 09:56'!initialize	super initialize .	! !Objeto subclass: #Pocion	instanceVariableNames: 'cantidadACurar tipo'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Pocion methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:55'!SurtirEfectoa: unPersonaje	 unPersonaje aumentarHP: self curar.	 self commitSepukku .! !!Pocion methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/24/2012 12:03'!curar ^ cantidadACurar ! !!Pocion methodsFor: 'as yet unclassified' stamp: 'IvanMadrid 10/28/2012 18:58'!initialize 	| unParametro elSegundoParametro |	super initialize .	self addMorph: (ImageReadWriter formFromFileNamed: 'starpotion.gif') asMorph.	self bounds:((200@300) corner: (43@49)). 		cantidadACurar := 5.	tipo:= 'normal'.	self unMetodoQueNoExisteTomaParametro: unParametro quetampocoExisteyEsteMenos: elSegundoParametro.! !Objeto subclass: #Cofre	instanceVariableNames: 'cantidad contenido status'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Cofre methodsFor: 'as yet unclassified' stamp: 'IvanMadrid 10/28/2012 19:17'!initialize 	super initialize .	self addMorph: (ImageReadWriter formFromFileNamed: 'cofre1.png') asMorph.	self bounds:((200@200) corner: (40@40)). ! !ObjetoDeEscenario subclass: #Item	instanceVariableNames: 'nombreElemento'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Item methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/22/2012 00:02'!SetNombreDeElemento: unNombre	nombreElemento  = unNombre ! !!Item methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/22/2012 00:02'!nombreDelElemento	^nombreElemento ! !Objeto subclass: #Arma	instanceVariableNames: 'hitbox daño poder'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 16:40'!SurtirEfectoa: unPersonaje	| unpoder |	Transcript show: 'El poder del arma es de', self poder asString ;cr.	unpoder := self poder.		unPersonaje disminuirHP: self poder.	Transcript show: '======Ahora', unPersonaje asString , 'tiene hp de', unPersonaje HP asString ;cr.		unPersonaje HP > 0 ifFalse: [ Transcript show: 'xxxxxOH ', unPersonaje asString , ' HA MUERTO!!';cr.									unPersonaje commitSepukku ].! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 15:54'!daño ^daño ! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 15:54'!daño: unDañoDefault	daño = unDañoDefault ! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 14:27'!hitbox	^hitbox ! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 14:27'!hitbox: unaCantidad	hitbox := unaCantidad ! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 16:27'!initialize 	super initialize .	self color: Color green .	self poder: 2.	self hitbox: 5.! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 16:28'!poder ^poder! !!Arma methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/26/2012 16:39'!poder: unDefault	poder := unDefault ! !PasteUpMorph subclass: #Escenario	instanceVariableNames: 'conjuntoDeEntidades marcador nombre motorDeJuego delegadoDeAcciones'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/26/2012 13:00'!asignaDelegados 	conjuntoDeEntidades do: [:each |		(each className asSymbol == #Jugador ) ifTrue: 			[each asignaDelegadoMovimiento: self .			 Transcript show:'Acabo de asignar como delegado movimiento el objeto ', self asString ,' en el objeto de ', each asString ;cr.			each setDelegadoDeAcciones: self.			Transcript show:'Acabo de asignar como delegado movimiento el objeto ', self asString ,' en el objeto de ', each asString ;cr.			].		(each className asSymbol == #Enemigo ) ifTrue: 			[each asignaDelegadoMovimiento: self .			 Transcript  show: 'Acabo de asignar como delegado movimiento el objeto ', self asString ,' en el objeto de ', each asString ;cr. ].  		each setDelegadoDeNivel: self].! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/26/2012 14:40'!añadirEntidad: unaEntidad enPosicion: unaPosicion	unaEntidad position: unaPosicion .	unaEntidad setDelegadoDeNivel: self.		self obtenerConjuntoDeEntidades add: unaEntidad.		self addMorph: unaEntidad .! !!Escenario methodsFor: 'initialization' stamp: 'IvanMadrid 10/28/2012 19:47'!inicializaEntidades	| unaListaDeEntidadesDiversas|			unaListaDeEntidadesDiversas := OrderedCollection new.	unaListaDeEntidadesDiversas add: Jugador new.	unaListaDeEntidadesDiversas add: Enemigo new.	unaListaDeEntidadesDiversas add: Pocion new.	unaListaDeEntidadesDiversas add: Cofre new.	unaListaDeEntidadesDiversas add: CorazonJugador new.	unaListaDeEntidadesDiversas add: CorazonJugador new.	unaListaDeEntidadesDiversas add: CorazonJugador new.	unaListaDeEntidadesDiversas add: CorazonJugador new.	self setConjuntoDeEntidades: unaListaDeEntidadesDiversas ! !!Escenario methodsFor: 'initialization' stamp: 'IvanMadrid 10/28/2012 18:18'!initialize	super initialize.	self inicializaEntidades .	self disableDragNDrop.	bounds := 0@0 corner: 400@400.	color := Color paleBlue darker.	self addMorph: (ImageReadWriter formFromFileNamed: 'background.jpg') asMorph.	conjuntoDeEntidades do: [:each | self addMorph: each . Transcript show: 'agregada instancia de ', each asString ; cr. ].	! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/23/2012 01:22'!obtenerConjuntoDeEntidades^conjuntoDeEntidades ! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/24/2012 00:59'!obtenerHitbox 	"aqui definimos el valor que toma el hitbox del personaje a partir de su posicion"	^ 15! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/26/2012 16:39'!personaje: unPersonaje atacaAPosicion: direccionALaQueAtaco| posArma arma|Transcript show:':::::::::::::::::::', unPersonaje asString ,' atacara en direccion: ', direccionALaQueAtaco asString;cr.direccionALaQueAtaco = 28 ifTrue: [posArma := (unPersonaje position) + ((-30)@0)]  "Arma a la izquierda".direccionALaQueAtaco  = 29 ifTrue: [posArma :=(unPersonaje position) + (30@0)]  "Arma a la derecha".direccionALaQueAtaco = 30 ifTrue: [posArma :=(unPersonaje position ) + (0@(-30))] "Arma arriba".direccionALaQueAtaco = 31 ifTrue: [posArma := (unPersonaje position ) + (0@30)]  "Arma Abajo".Transcript show: '::::::::::::::::::::::::::::::Si personaje se ubica en', unPersonaje position asString , ' ... entonces arma debe ir en: ', posArma asString ;cr.arma:= Arma new.arma poder:3.Transcript show: 'El arma con poder de ', arma poder asString ;cr.self añadirEntidad: arma enPosicion: posArma .self verificarSolapamiento .arma commitSepukku .! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/25/2012 11:29'!quitarLaInstancia: unaInstancia	Transcript show: 'quitar la instancia', unaInstancia asString , ' de la lista'; cr.	"TODO: quitar una instancia de lista de instancias"	conjuntoDeEntidades remove: unaInstancia .	Transcript show: 'Una instancia eliminada, se supone :), pues la lista ahora es: ', self obtenerConjuntoDeEntidades asString ; cr.! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/22/2012 10:35'!setConjuntoDeEntidades: unaColleccionDeEntidades	conjuntoDeEntidades := unaColleccionDeEntidades ! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/24/2012 08:36'!setDelegadoDeAcciones: unDelegadoDeAcciones	delegadoDeAcciones := unDelegadoDeAcciones ! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/22/2012 10:36'!setMarcador	marcador := 0 ! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/23/2012 01:01'!setMotorDeJuego: unDelegado	motorDeJuego := unDelegado ! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/22/2012 10:36'!setNombre: unNombre	nombre := unNombre ! !!Escenario methodsFor: 'initialization' stamp: 'EduardoValenzuela 10/26/2012 15:42'!verificarSolapamiento	| coleccionDeEntidades colleccionDeEntidadesDeAccion|		coleccionDeEntidades  := OrderedCollection  new.	colleccionDeEntidadesDeAccion := OrderedCollection new. 	 (conjuntoDeEntidades reject: [:each | ((each className asSymbol) == #Jugador) | ((each className asSymbol ) == #Arma)]) do: [:each | Transcript  show: 'extrayendo punto de ' , each asString ; cr. coleccionDeEntidades  add: each.].			 (conjuntoDeEntidades select: [:each | ((each className asSymbol) == #Arma) | ((each className asSymbol) == #Jugador) ] ) do: [:each | Transcript  show: 'extrayendo punto de ' , each asString ; cr. colleccionDeEntidadesDeAccion   add: each.].			Transcript show: '_____El conjunto de puntos de la coleccion Entidades es la siguiente: ', coleccionDeEntidades  asString  ;cr.	Transcript show: '_____El conjunto de puntos de la coleccion Entidades De acciones la siguiente: ', colleccionDeEntidadesDeAccion   asString  ;cr.				colleccionDeEntidadesDeAccion   do:	[:laEntidadSolapante |				coleccionDeEntidades  do:		[ :laEntidadSolapada |		 			Transcript show:laEntidadSolapante asString ,' Pos:  ', laEntidadSolapante  position asString  , ' morph: ', laEntidadSolapada  asString, 'Pos: ',laEntidadSolapada  position asString ; cr.(     ((laEntidadSolapante  posX + (self obtenerHitbox)) > (laEntidadSolapada   posX - (self obtenerHitbox))) &	((laEntidadSolapante  posX - (self obtenerHitbox )) < (laEntidadSolapada   posX +(self obtenerHitbox))) &		((laEntidadSolapante  posY + (self obtenerHitbox )) > (laEntidadSolapada   posY - (self obtenerHitbox))) &		((laEntidadSolapante  posY - (self obtenerHitbox)) < (laEntidadSolapada   posY  + (self obtenerHitbox )))    ) 										ifTrue: 					[ Transcript show: '---------El ' , laEntidadSolapante asString ,' a solapado con objeto: ' , laEntidadSolapada  asString , 'punto: ',laEntidadSolapada  position asString ; cr. 												delegadoDeAcciones laEntidad: laEntidadSolapante  haSolapadoA: laEntidadSolapada .]						].	 	   ]! !Personaje subclass: #Jugador	instanceVariableNames: 'delegadoDeAcciones'	classVariableNames: ''	poolDictionaries: ''	category: 'AdventureGame'!!Jugador methodsFor: '*Keymapping-Core-override' stamp: 'EduardoValenzuela 10/25/2012 11:09'!handleKeystroke: anEvent 	| keyValue |	keyValue := anEvent keyValue. 	keyValue = 30 "up arrow" 		ifTrue: [self position: self position - (0 @ 15)]. 	keyValue = 31 "down arrow" 		ifTrue: [self position: self position + (0 @ 15)].	keyValue = 29 "right arrow"		ifTrue: [self position: self position + (15 @ 0)].	keyValue = 28 "left arrow"		ifTrue: [self position: self position - (15 @ 0)].		keyValue = 32 "spaceBar"		ifTrue: [delegadoDeAcciones personaje: self atacaAPosicion: orientacion ];		ifFalse: [orientacion := keyValue ].	delegadoMovimiento verificarSolapamiento .! !!Jugador methodsFor: '*Polymorph-Widgets' stamp: 'EduardoValenzuela 9/23/2012 19:02'!handlesMouseOver: anEvent	^true! !!Jugador methodsFor: 'event handling' stamp: 'EduardoValenzuela 9/23/2012 19:03'!mouseLeave: anEvent 	anEvent hand newKeyboardFocus: self! !!Jugador methodsFor: 'initialize' stamp: 'IvanMadrid 10/28/2012 19:10'!initialize 	super initialize.		self setOrientacion: 28.	self takeKeyboardFocus.	self addMorph: (ImageReadWriter formFromFileNamed: 'jugador.png') asMorph.	self height: 3.0.	self width: 3.0.	self bounds:( (60@60) corner: (0@0)).! !!Jugador methodsFor: 'Logica de Jugador' stamp: 'EduardoValenzuela 10/2/2012 10:24'!movimientoALaDerecha	| pos |		pos := self position .	pos x > 350 ifTrue: [^false].	^true.! !!Jugador methodsFor: 'Logica de Jugador' stamp: 'EduardoValenzuela 10/2/2012 10:23'!movimientoALaIzquierda	| pos |		pos := self position.		pos x < 100 ifTrue: [^ false] .	^ true.! !!Jugador methodsFor: 'Logica de Jugador' stamp: 'EduardoValenzuela 10/2/2012 10:25'!movimientoAbajo	| pos |	pos := self position .	pos y > 350 ifTrue: [^false].	^true.! !!Jugador methodsFor: 'Logica de Jugador' stamp: 'EduardoValenzuela 10/2/2012 10:29'!movimientoArriba	| pos |	pos := self position .	pos y < 100 ifTrue: [^false] .	^true .! !!Jugador methodsFor: 'Logica de Jugador' stamp: 'EduardoValenzuela 10/1/2012 08:56'!movimientoValido: unaDireccion	"verifica en el nivel que no esté traspasando un morph"	| pos |		pos := self position.		(pos x > 350 & (unaDireccion value == 4) )"derecha"		ifTrue:  [ ^false ].	(pos y > 350 & (unaDireccion value == 2) )"abajo"		ifTrue: [ ^false ].	(pos x < 115 & (unaDireccion value == 3) ) "izquierda"		ifTrue: [ ^false ].	(pos y < 115 & (unaDireccion value == 1) )"arriba"		ifTrue: [ ^false ].		^true.! !!Jugador methodsFor: 'as yet unclassified' stamp: 'EduardoValenzuela 10/23/2012 01:07'!setDelegadoDeAcciones: unDelegado 	delegadoDeAcciones := unDelegado ! !